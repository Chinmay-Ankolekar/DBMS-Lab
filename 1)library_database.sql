-- 1)
-- Consider the following schema for a Library Database:
-- BOOK (Book_id, Title, Publisher_Name, Pub_Year) 
-- BOOK_AUTHORS (Book_id, Author_Name) 
-- PUBLISHER (Name, Address, Phone)
-- BOOK_COPIES (Book_id, Branch_id, No-of_Copies)
-- BOOK_LENDING (Book_id, Branch_id, Card_No, Date_Out, Due_Date) 
-- LIBRARY_BRANCH (Branch_id, Branch_Name, Address)

show databases;

create database library;

CREATE TABLE PUBLISHER (
NAME VARCHAR (18) PRIMARY KEY, 
ADDRESS VARCHAR (10),
PHONE VARCHAR (10));

CREATE TABLE BOOK (
BOOK_ID INTEGER PRIMARY KEY,
TITLE VARCHAR (20),
PUBLISHER_NAME VARCHAR (20) REFERENCES PUBLISHER(NAME)ON DELETE CASCADE,
PUB_YEAR INT (4));

CREATE TABLE BOOK_AUTHORS (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, AUTHOR_NAME VARCHAR (20),
PRIMARY KEY(BOOK_ID));


CREATE TABLE LIBRARY_BRANCH( 
            BRANCH_ID INTEGER PRIMARY KEY,
             BRANCH_NAME VARCHAR(18), 
           ADDRESS VARCHAR(15));
          
CREATE TABLE BOOK_COPIES (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, 
BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
NO_OF_COPIES INTEGER, PRIMARY KEY (BOOK_ID, BRANCH_ID));

CREATE TABLE BOOK_LENDING (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, 
BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
CARD_NO INTEGER, 
DATE_OUT DATE, 
DUE_DATE DATE, PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO));

INSERT INTO PUBLISHER VALUES('PEARSON','BANGALORE','9875462530'); 
INSERT INTO PUBLISHER VALUES('MCGRAW','NEWDELHI','7845691234'); 
INSERT INTO PUBLISHER VALUES('SAPNA','BANGALORE','7845963210');

INSERT INTO BOOK VALUES(1111,'SE','PEARSON',2005); 
INSERT INTO BOOK VALUES(2222,'DBMS','MCGRAW',2004);
INSERT INTO BOOK VALUES(3333,'ANOTOMY','PEARSON',2010); 
INSERT INTO BOOK VALUES(4444,'ENCYCLOPEDIA','SAPNA',2010);

INSERT INTO	BOOK_AUTHORS VALUES(1111,'SOMMERVILLE');
INSERT INTO	BOOK_AUTHORS VALUES(2222,'NAVATHE');
INSERT INTO	BOOK_AUTHORS  VALUES(3333,'HENRY GRAY');
INSERT INTO	BOOK_AUTHORS VALUES(4444,'THOMAS');


INSERT	INTO	LIBRARY_BRANCH	VALUES(11,'CENTRAL TECHNICAL','MG ROAD');
INSERT	INTO	LIBRARY_BRANCH	VALUES(22,'MEDICAL','BH ROAD');
INSERT	INTO	LIBRARY_BRANCH	VALUES(33,'CHILDREN','SS PURAM');
INSERT	INTO	LIBRARY_BRANCH	VALUES(44,'SECRETARIAT','SIRAGATE');
INSERT	INTO	LIBRARY_BRANCH	VALUES(55,'GENERAL','JAYANAGAR');

INSERT INTO	BOOK_COPIES	VALUES(1111,11,5);
INSERT	INTO	BOOK_COPIES	VALUES(3333,22,6);
INSERT	INTO	BOOK_COPIES	VALUES(4444,33,10);
INSERT	INTO	BOOK_COPIES	VALUES(2222,11,12);
INSERT	INTO	BOOK_COPIES	VALUES(4444,55,3);

INSERT	INTO	BOOK_LENDING	VALUES(2222,11,1, '2017-01-10','2017-08-20');
INSERT	INTO	BOOK_LENDING	VALUES(3333,22,2, '2017-07-09','2017-08-12');
INSERT	INTO	BOOK_LENDING	VALUES(4444,55,1, '2017-04-11','2017-08-09');
INSERT	INTO	BOOK_LENDING	VALUES(2222,11,5, '2017-08-09','2017-08-19');
INSERT	INTO	BOOK_LENDING	VALUES(4444,33,1, '2017-06-08','2017-08-15');
INSERT	INTO	BOOK_LENDING	VALUES(1111,11,1, '2017-05-12','2017-06-10');
INSERT	INTO	BOOK_LENDING	VALUES(3333,22,1, '2017-07-10','2017-07-15');

-- queries
-- 1)Retrieve the details of all books in the library â€“ id, title, name of publisher, authors, number 
-- of copies in each branch, etc.
SELECT B.Book_id, B.Title, B.Publisher_Name, BA.Author_Name, BC.Branch_id, BC.No_of_Copies, L.Branch_Name
FROM BOOK B
NATURAL JOIN BOOK_AUTHORS BA
NATURAL JOIN BOOK_COPIES BC
NATURAL JOIN LIBRARY_BRANCH L;

-- or

SELECT LB. BRANCH_NAME, B. BOOK_ID, TITLE, PUBLISHER_NAME, AUTHOR_NAME, NO_OF_COPIES 
FROM BOOK B, BOOK_AUTHORS BA, BOOK_COPIES BC, LIBRARY_BRANCH LB 
WHERE B. BOOK_ID = BA. BOOK_ID AND BA. BOOK_ID = BC. BOOK_ID AND BC. BRANCH_ID = LB. BRANCH_ID 
GROUP BY LB. BRANCH_NAME, B. BOOK_ID, TITLE, PUBLISHER_NAME, AUTHOR_NAME, NO_OF_COPIES;

-- 2)Get the particular borrowers who have borrowed more than 3 books from Jan 2017 to Jun 
-- 2017.
SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-06-30'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;

-- 3)Delete a book in BOOK table and Update the contents of other tables using DML 
-- statements.
DELETE FROM BOOK WHERE BOOK_ID = '3333';

-- 4)Create the view for BOOK table based on year of publication and demonstrate its working 
-- with a simple query.
CREATE VIEW V_PUBLICATION AS SELECT BOOK_ID, TITLE, PUBLISHER_NAME,PUB_YEAR 
FROM BOOK 
ORDER BY PUB_YEAR;

select * from V_PUBLICATION;

-- 5)Create a view of all books and its number of copies which are currently available in the 
-- Library.
CREATE VIEW AvailableBooks AS
SELECT B.Book_id, B.Title, B.Publisher_Name, BC.Branch_id, BC.No_of_Copies
FROM BOOK B
NATURAL JOIN BOOK_COPIES BC;

select * from AvailableBooks;

-- or

CREATE VIEW BOOKS_AVAILABLE AS 
SELECT B. BOOK_ID, B. TITLE,C.NO_OF_COPIES 
FROM LIBRARY_BRANCH L, BOOK B, BOOK_COPIES C 
WHERE B. BOOK_ID = C. BOOK_ID AND L. BRANCH_ID=C.BRANCH_ID;

select * from BOOKS_AVAILABLE;







